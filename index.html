<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2025 Memory Receipt</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
      :root {
        --bg: #0b0b0b;
        --paper: #ffffff;
      }

      body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        background-color: var(--bg);
        margin: 0;
        padding: 50px 0 120px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #poster-area {
        width: 380px;
        background-color: var(--paper);
        padding: 50px 25px 40px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
      }

      /* 헤더 */
      .header-box {
        background-color: #000;
        width: 260px;
        height: 130px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
      }

      .white-oval {
        background-color: #fff;
        width: 92%;
        height: 85%;
        border-radius: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .white-oval span {
        color: #000;
        font-size: 80px;
        font-weight: 900;
        line-height: 1;
      }

      /* 캡처 시 숨겨질 설명문구 */
      .project-description {
        text-align: center;
        width: 100%;
        margin-bottom: 40px;
        font-size: 11px;
        line-height: 1.6;
        color: #333;
        font-weight: 500;
      }

      .receipt-title {
        text-align: center;
        font-size: 13px;
        font-weight: 900;
        letter-spacing: 2px;
        text-transform: uppercase;
        margin-bottom: 20px;
        border-bottom: 2px solid #000;
        width: 100%;
        padding-bottom: 8px;
      }

      /* 갤러리 아이템 */
      .gallery-wrapper {
        width: 100%;
      }

      .item-row {
        border-bottom: 1px dashed #eee;
        overflow: hidden;
        background: white;
        display: flex;
        flex-direction: column;
        transition: all 0.4s ease;
      }

      .item-row.folded {
        max-height: 45px;
        opacity: 0.3;
        filter: grayscale(1);
      }

      .item-row.active {
        max-height: 1200px;
        opacity: 1;
        padding: 20px 0;
      }

      .item-meta {
        display: flex;
        justify-content: space-between;
        font-size: 11px;
        font-weight: 800;
        line-height: 40px;
      }

      .img-container {
        width: 100%;
        margin: 5px 0;
        cursor: pointer;
      }

      .img-container img {
        width: 100%;
        display: block;
      }

      /* 캡처 시 잘림 방지 텍스트 스타일 */
      .caption-input {
        width: 100%;
        border: none;
        border-bottom: 1px solid #000;
        font-family: inherit;
        font-size: 12px;
        font-weight: 900;
        text-align: center;
        padding: 10px 0;
        outline: none;
        text-transform: uppercase;
      }

      .caption-display {
        width: 100%;
        font-size: 12px;
        font-weight: 900;
        text-align: center;
        padding: 15px 0;
        text-transform: uppercase;
        line-height: 1.4;
      }

      .placeholder-btn {
        width: 100%;
        padding: 40px 0;
        background: #fdfdfd;
        text-align: center;
        font-size: 10px;
        color: #999;
        border: 1px dashed #ddd;
        font-weight: 700;
      }

      /* 푸터 */
      #footer-area {
        display: none;
        margin-top: 25px;
        border-top: 2px solid #000;
        padding-top: 30px;
        text-align: center;
        width: 100%;
      }

      .barcode {
        width: 100%;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: flex-end;
        margin-bottom: 15px;
      }

      .b-line {
        background: #000;
        height: 100%;
        margin: 0 1px;
      }

      .status-box {
        font-size: 22px;
        font-weight: 900;
        margin: 15px 0 5px 0;
        border: 3px solid #000;
        display: inline-block;
        padding: 5px 25px;
      }

      .zigzag-bottom {
        position: absolute;
        bottom: -15px;
        left: 0;
        width: 100%;
        height: 15px;
        background: linear-gradient(-45deg, var(--bg) 8px, transparent 0),
          linear-gradient(45deg, var(--bg) 8px, transparent 0);
        background-size: 16px 16px;
      }

      /* 컨트롤 버튼 */
      .controls {
        position: fixed;
        bottom: 30px;
        display: flex;
        gap: 10px;
        width: 380px;
        z-index: 100;
      }

      .btn {
        flex: 1;
        padding: 20px;
        border: none;
        background: #fff;
        color: #000;
        font-weight: 900;
        cursor: pointer;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        text-transform: uppercase;
      }

      #save-btn {
        display: none;
        background: #ff4a4a;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div id="poster-area">
      <div class="header-box">
        <div class="white-oval"><span>2025</span></div>
      </div>

      <div class="project-description" id="tutorial-text">
        <span style="font-weight: 700; font-size: 12px"
          >YEARLY CHECKOUT : MONTHLY ARCHIVE</span
        ><br />
        <br />HOW TO ARCHIVE YOUR 2025 <br />*SELECT: Click to upload a photo
        for each month. <br />*RECORD: Type your memory and press 'Enter' to
        confirm. *CHECKOUT: Complete all 12 months to download your receipt.<br />
      </div>

      <div class="receipt-title" id="dynamic-title">Memory Receipt</div>

      <div id="gallery-container" class="gallery-wrapper"></div>

      <div id="footer-area">
        <div class="barcode" id="barcode"></div>
        <p
          id="current-date"
          style="font-size: 9px; color: #888; margin-top: 20px"
        ></p>
      </div>

      <div class="zigzag-bottom"></div>
    </div>

    <div class="controls">
      <input type="file" id="file-input" hidden accept="image/*" />
      <button class="btn" id="save-btn">Download Archive</button>
    </div>

    <script>
      const monthNames = [
        'JANUARY',
        'FEBRUARY',
        'MARCH',
        'APRIL',
        'MAY',
        'JUNE',
        'JULY',
        'AUGUST',
        'SEPTEMBER',
        'OCTOBER',
        'NOVEMBER',
        'DECEMBER',
      ];
      let currentIdx = 1;

      function init() {
        const container = document.getElementById('gallery-container');
        for (let i = 1; i <= 12; i++) {
          const row = document.createElement('div');
          row.className = `item-row ${i === 1 ? 'active' : 'folded'}`;
          row.id = `row-${i}`;
          row.innerHTML = `
            <div class="item-meta"><span>#${String(i).padStart(
              2,
              '0'
            )}</span><span>${monthNames[i - 1]}</span></div>
            <div class="img-container" onclick="triggerUpload(${i})">
                <div id="img-slot-${i}" class="placeholder-btn">SELECT PHOTO</div>
            </div>
            <div id="caption-wrapper-${i}">
                <input type="text" class="caption-input" id="input-${i}" placeholder="TYPE KEYWORD & ENTER" style="display:none;">
                <div class="caption-display" id="display-${i}" style="display:none;"></div>
            </div>
          `;
          container.appendChild(row);
        }
      }
      init();

      function triggerUpload(idx) {
        if (idx === currentIdx) document.getElementById('file-input').click();
      }

      document.getElementById('file-input').onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          const slot = document.getElementById(`img-slot-${currentIdx}`);
          slot.innerHTML = `<img src="${ev.target.result}">`;
          slot.classList.remove('placeholder-btn');
          const input = document.getElementById(`input-${currentIdx}`);
          input.style.display = 'block';
          input.focus();
          input.onkeydown = (event) => {
            if (event.key === 'Enter') confirmEntry();
          };
        };
        reader.readAsDataURL(file);
      };

      function confirmEntry() {
        const input = document.getElementById(`input-${currentIdx}`);
        const display = document.getElementById(`display-${currentIdx}`);
        display.innerText = input.value || 'MEMORIES';
        input.style.display = 'none';
        display.style.display = 'block';

        document
          .getElementById(`row-${currentIdx}`)
          .classList.replace('active', 'folded');
        if (currentIdx < 12) {
          currentIdx++;
          const next = document.getElementById(`row-${currentIdx}`);
          next.classList.replace('folded', 'active');
          next.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          showFooter();
        }
      }

      function showFooter() {
        document.getElementById('footer-area').style.display = 'block';
        document.getElementById('save-btn').style.display = 'block';
        const bc = document.getElementById('barcode');
        bc.innerHTML = '';
        for (let i = 0; i < 50; i++) {
          const line = document.createElement('div');
          line.className = 'b-line';
          line.style.width = Math.floor(Math.random() * 3 + 1) + 'px';
          bc.appendChild(line);
        }
        document.getElementById('current-date').innerText =
          'ISSUE DATE: ' + new Date().toLocaleString().toUpperCase();
      }

      document.getElementById('save-btn').onclick = async () => {
        const area = document.getElementById('poster-area');
        const rows = document.querySelectorAll('.item-row');
        const tutorial = document.getElementById('tutorial-text');

        // 캡처 전 세팅: 튜토리얼 숨기기 + 모든 행 펼치기
        tutorial.style.display = 'none';
        rows.forEach((r) => {
          r.style.maxHeight = 'none';
          r.style.opacity = '1';
          r.style.filter = 'none';
          r.style.display = 'flex';
        });

        // 1-6월 저장
        document.getElementById('dynamic-title').innerText =
          'Memory Receipt (01-06)';
        rows.forEach((r, i) => (r.style.display = i < 6 ? 'flex' : 'none'));
        document.getElementById('footer-area').style.display = 'none';
        await capture(area, '2025_Archive_Part1.png');

        // 7-12월 저장
        document.getElementById('dynamic-title').innerText =
          'Memory Receipt (07-12)';
        rows.forEach((r, i) => (r.style.display = i >= 6 ? 'flex' : 'none'));
        document.getElementById('footer-area').style.display = 'block';
        await capture(area, '2025_Archive_Part2.png');

        // 원상복구
        tutorial.style.display = 'block';
        document.getElementById('dynamic-title').innerText =
          'Memory Receipt (Complete)';
        rows.forEach((r, i) => {
          r.style.display = 'flex';
          r.style.maxHeight = i + 1 === currentIdx ? '1200px' : '45px';
          r.style.opacity = i + 1 === currentIdx ? '1' : '0.3';
        });
      };

      async function capture(el, filename) {
        const canvas = await html2canvas(el, {
          scale: 3,
          backgroundColor: '#ffffff',
          logging: false,
          useCORS: true,
        });
        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL('image/png');
        link.click();
        await new Promise((r) => setTimeout(r, 500));
      }
    </script>
  </body>
</html>
